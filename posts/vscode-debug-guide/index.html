<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>
        
            Visual Studio Code 前端调试不完全指南 | 咀嚼之味
        </title>
    <meta name="viewport" content="width=device-width">
    <meta name="description" content="Visual Studio Code (以下简称 vscode) 如今已经代替 Sublime，成为前端工程师们最喜爱的代码编辑器。它作为一个大型的开源项目，不断推陈出新；社区中涌现出大量优质的插件，以支持我们更加舒服地进行开发工作。在近期的工作中，我尝试通过 vscode 来提升调试代码的幸福度，积累了一点点小心得在此与大家分享一下 ">
    <link rel="alternate" type="application/rss+xml" title="咀嚼之味 RSS" href="/feed.xml">
    <link rel="canonical" href="https://jerryzou.com/posts/vscode-debug-guide/">
    <link href="/assets/images/favicon.ico" rel="shortcut icon" type="image/x-icon" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/release/style.4859b73a.css">

    <!-- Baidu Analysis -->
    <script>
        if (window.location.href.substr(7, 9) !== 'localhost') {
            var _hmt = _hmt || [];
            (function() {
                var hm = document.createElement("script");
                hm.src = "//hm.baidu.com/hm.js?2744fd74aa568e064f9986394a60ead1";
                var s = document.getElementsByTagName("script")[0]; 
                s.parentNode.insertBefore(hm, s);
            })();
        }
    </script>

    <!-- Google Analytics -->
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-47842677-1', 'auto');
        ga('send', 'pageview');
    </script>

    <!-- Hit Kounter LC -->
    <script src="https://sinacloud.net/egg-lib/hit-kounter/hit-kounter-lc-0.4.1.js" async></script>

    <!-- handle external js files -->
    <script src="/assets/js/lib/jquery/jquery-1.11.1.min.js"></script>
</head>


    <body>

    <header class="site-header">
  <div class="wrap">
    <a class="site-title" href="/">咀嚼之味</a>
    <nav class="site-nav">
      <div class="menu-icon">
        <img class="icon" src="https://sinacloud.net/heaven-blog-files/images/menu.svg" title="More"/>
      </div>
      <div class="trigger">
        <a class="page-link" href="/">首页</a>
        
          
          <a class="page-link" href="/all-articles/">所有文章</a>
          
        
          
          <a class="page-link" href="/about/">关于我</a>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          <a class="page-link" href="/feed.xml">RSS订阅</a>
      </div>
    </nav>
  </div>
</header>


    <div class="page-content">
      <div class="wrap">
        
        <div class="post">

  <header class="post-header">
    <h1>Visual Studio Code 前端调试不完全指南</h1>
    <p class="meta">May 20, 2017 <span class="pause"> - </span>
        浏览量：<span data-hk-page="current"> - </span>次<span class="pause"> | </span>
        
            
                <a class="label" href="/all-articles/?label=vscode">vscode</a>
            
                <a class="label" href="/all-articles/?label=debug">debug</a>
            
                <a class="label" href="/all-articles/?label=JavaScript">JavaScript</a>
            
        
    </p>
  </header>

  <article class="post-content">
  <p><strong>Visual Studio Code</strong> (以下简称 vscode) 如今已经代替 Sublime，成为前端工程师们最喜爱的代码编辑器。它作为一个大型的开源项目，不断推陈出新；社区中涌现出大量优质的插件，以支持我们更加舒服地进行开发工作。在近期的工作中，我尝试通过 vscode 来提升调试代码的幸福度，积累了一点点小心得在此与大家分享一下。</p>

<p>接下来的内容将从以下几方面进行展开：</p>

<ol>
  <li>launch / attach</li>
  <li>调试前端代码</li>
  <li>调试通过 Nodemon 启动的 Node 服务器</li>
</ol>

<h2 id="1-launch--attach">1. launch / attach</h2>

<p>要使用 vscode 的调试功能，首先就得配置 <code class="language-plaintext highlighter-rouge">.vscode/launch.json</code> 文件。以最简单的 Node 调试配置为例：</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
    </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.2.0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"configurations"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"node"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"request"</span><span class="p">:</span><span class="w"> </span><span class="s2">"launch"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Launch"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"program"</span><span class="p">:</span><span class="w"> </span><span class="s2">"${workspaceRoot}/index.js"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"node"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"request"</span><span class="p">:</span><span class="w"> </span><span class="s2">"attach"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Attach"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"port"</span><span class="p">:</span><span class="w"> </span><span class="mi">5858</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p>其中最重要的参数是 <code class="language-plaintext highlighter-rouge">request</code> ，它的取值有两种 <code class="language-plaintext highlighter-rouge">launch</code> 和 <code class="language-plaintext highlighter-rouge">attach</code>。</p>

<ul>
  <li><strong>launch</strong>模式：<strong>由 vscode 来启动</strong>一个独立的具有 debug 模式的程序</li>
  <li><strong>attach</strong>模式：附加于（也可以说“监听”）一个<strong>已经启动的程序</strong>（必须已经开启 Debug 模式）</li>
</ul>

<p>这两种截然不同的模式到底有什么具体的应用场景呢？且看后文。</p>

<h2 id="2-调试前端代码">2. 调试前端代码</h2>

<p>通过 vscode 调试前端代码主要依赖于一个插件：<a href="https://github.com/Microsoft/vscode-chrome-debug">Debugger for Chrome</a>，该插件主要利用 <a href="https://chromedevtools.github.io/devtools-protocol/">Chrome 所开放出来的接口</a> 来实现对其渲染的页面进行调试。可以通过 <code class="language-plaintext highlighter-rouge">Shift + Cmd + X</code> 打开插件中心，搜索对应插件后直接安装。安装完成并重新加载 vscode 后，可以直接点击调试按钮并创建新的启动配置。如果你之前已经创建过启动配置了，就可以直接打开 <code class="language-plaintext highlighter-rouge">.vscode/launch.json</code> 进行修改。</p>

<p><img src="https://sinacloud.net/heaven-blog-files/images/posts/vscode-debug-chrome.png" alt="vscode-debug-chrome" /></p>

<p>其中调试 Chrome 页面的配置如下所示：</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
    </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.2.0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"configurations"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"chrome"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"request"</span><span class="p">:</span><span class="w"> </span><span class="s2">"launch"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"启动一个独立的 Chrome 以调试 frontend"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8091/frontend"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"webRoot"</span><span class="p">:</span><span class="w"> </span><span class="s2">"${workspaceRoot}/frontend"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p>如之前所述，通过第一个 launch 配置就能启动一个通过 vscode 调试的 Chrome。大家可以直接使用我组织好的项目 <a href="https://github.com/zry656565/vscode-debug-sample">zry656565/vscode-debug-sample</a> 进行测试，测试方法在该项目的 README 里面写得很清楚了。简要步骤概括为：</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">npm run frontend</code></li>
  <li>启动调试配置：“启动一个独立的 Chrome 以调试 frontend”</li>
  <li>在 <code class="language-plaintext highlighter-rouge">frontend/index.js</code> 中加断点</li>
  <li>访问 <code class="language-plaintext highlighter-rouge">http://localhost:8091/frontend/</code></li>
</ol>

<h3 id="延伸问题">延伸问题</h3>

<p>使用 <code class="language-plaintext highlighter-rouge">launch</code> 模式调试前端代码存在一个问题，就是 vscode 会以新访客的身份打开一个新的 Chrome 进程，也就是说你<strong>之前在 Chrome 上装的插件都没法在这个页面上生效</strong>（如下图所示）。</p>

<p><img src="https://sinacloud.net/heaven-blog-files/images/posts/vscode-debug-launch.png" alt="vscode-debug-launch" /></p>

<p>在这种情况下 <code class="language-plaintext highlighter-rouge">attach</code> 模式就有它存在的意义了：对一个已经启动的 Chrome 进行监听调试。</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
    </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.2.0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"configurations"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"chrome"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"request"</span><span class="p">:</span><span class="w"> </span><span class="s2">"attach"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"监听一个已经启动调试模式的 Chrome"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"port"</span><span class="p">:</span><span class="w"> </span><span class="mi">9222</span><span class="p">,</span><span class="w">
            </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8091/frontend"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"webRoot"</span><span class="p">:</span><span class="w"> </span><span class="s2">"${workspaceRoot}/frontend"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p>其中 9222 是 Chrome 的调试模式推荐的端口，可以根据需要进行修改。不过目前我并没有成功实施这个设想，对此有兴趣的同学可以从下面这两个链接入手去研究一下：</p>
<ul>
  <li><a href="https://chromedevtools.github.io/devtools-protocol/">Chrome DevTools Protocol Viewer</a></li>
  <li><a href="https://github.com/Microsoft/vscode-chrome-debug/blob/master/README.md#attach">Debugger for Chrome / Attach</a></li>
</ul>

<p>有一部分遇到的问题可以直接在 Debugger for Chrome 的 FAQ 中得到解答。</p>

<h2 id="3-调试通过-nodemon-启动的-node-服务器">3. 调试通过 Nodemon 启动的 Node 服务器</h2>

<p>如今，使用 Node 服务器开发一些中间层的服务也慢慢纳入了所谓“大前端”的范畴。而在开发 Node 服务时，我们通常要借助类似于 <a href="https://github.com/remy/nodemon">nodemon</a> 这样的工具来避免频繁手动重启服务器。在这种情况下，我们又如何利用 vscode 来进行断点调试呢？先来看看示例配置文件：</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="p">{</span><span class="w">
    </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.2.0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"configurations"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"node"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"request"</span><span class="p">:</span><span class="w"> </span><span class="s2">"attach"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"附加于已启动的 Node 服务器（debug模式）"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"port"</span><span class="p">:</span><span class="w"> </span><span class="mi">5858</span><span class="p">,</span><span class="w">
            </span><span class="nl">"restart"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"node"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"request"</span><span class="p">:</span><span class="w"> </span><span class="s2">"attach"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"附加于已启动的 Node 服务器（inspect模式）"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"port"</span><span class="p">:</span><span class="w"> </span><span class="mi">9229</span><span class="p">,</span><span class="w">
            </span><span class="nl">"restart"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span></code></pre></figure>

<p>首先，为了配合 nodemon 在监听到文件修改时重启服务器，此处需要添加一个 <code class="language-plaintext highlighter-rouge">restart</code> 参数。同时大家可能注意到了，这里给出了两种模式，大家可能根据以下区别来选择合适自己的协议：</p>

<table>
  <thead>
    <tr>
      <th>Runtime</th>
      <th>‘Legacy Protocol’</th>
      <th>‘Inspector Protocol’</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>io.js</td>
      <td>all</td>
      <td>no</td>
    </tr>
    <tr>
      <td>node.js</td>
      <td>&lt; 8.x</td>
      <td>&gt;= 6.3 (Windows: &gt;= 6.9)</td>
    </tr>
    <tr>
      <td>Electron</td>
      <td>all</td>
      <td>not yet</td>
    </tr>
    <tr>
      <td>Chakra</td>
      <td>all</td>
      <td>not yet</td>
    </tr>
  </tbody>
</table>

<p>通俗来说，旧版 Node (&lt; 6.3) 推荐使用 Legacy Protocol (<code class="language-plaintext highlighter-rouge">--debug</code>模式，默认 5858 端口)，而新版的 Node (&gt;= 6.3) 推荐使用 Inspector Protocol (<code class="language-plaintext highlighter-rouge">--inspect</code>模式，默认 9229 端口)。</p>

<p>需要注意的是，在启动 nodemon 程序时，也要添加对应的参数，比如：</p>

<figure class="highlight"><pre><code class="language-shell-session" data-lang="shell-session"><span class="go">nodemon --debug server/app.js
nodemon --inspect server/app.js</span></code></pre></figure>

<p>详细的例子同样可以在 <a href="https://github.com/zry656565/vscode-debug-sample">zry656565/vscode-debug-sample</a> 中找到。</p>

<h2 id="参考资料">参考资料</h2>

<ul>
  <li><a href="https://github.com/Microsoft/vscode-chrome-debug/blob/master/README.md">VS Code - Debugger for Chrome - README</a></li>
  <li><a href="https://code.visualstudio.com/docs/editor/debugging">Debugging in VS Code</a></li>
  <li><a href="https://chromedevtools.github.io/devtools-protocol/">Chrome DevTools Protocol Viewer</a></li>
  <li><a href="https://github.com/bdspen/nodemon_vscode">bdspen/nodemon_vscode</a></li>
  <li><a href="https://code.visualstudio.com/docs/nodejs/nodejs-debugging">Node.js Debugging in VS Code</a></li>
</ul>


  </article>

  
  <p class="copyright">
    本文的版权归作者 <a href="mailto:jerry.zry@outlook.com">邹润阳</a> 所有，采用 <a href="https://creativecommons.org/licenses/by-nc/3.0/">Attribution-NonCommercial 3.0 License</a>。任何人可以进行转载、分享，但不可在未经允许的情况下用于商业用途；转载请注明出处。感谢配合！
  </p>
  

  
</div>

        
      </div>
    </div>

    <footer class="site-footer">
    <div class="wrap">
        <p class="footer-text">
            本站使用 <a href="https://github.com/zry656565/heaven-blog">Github Pages & Jekyll</a>，总计访问量：<span data-hk-site>-</span>
        </p>
        <p class="footer-text">
            <a href="https://beian.miit.gov.cn" target="_blank">沪ICP备2022013634号-1</a>
        </p>
    </div>
</footer>


    </body>
</html>